<!DOCTYPE html>
<html>
<head>
    <title>psi-feature-burnup</title>

    <script type="text/javascript" src="https://rally1.rallydev.com/apps/2.0/sdk.js"></script>
    <script type="text/javascript" src="https://rally1.rallydev.com/apps/2.0rc1/lib/analytics/analytics-all.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/async/1.22/async.min.js"></script>

    <script type="text/javascript">
        Rally.onReady(function () {
                Ext.define("Ext.ux.CheckCombo",{extend:"Ext.form.field.ComboBox",alias:"widget.checkcombo",multiSelect:!0,allSelector:!1,noData:!1,noDataText:"No combo data",addAllSelector:!1,allSelectorHidden:!1,enableKeyEvents:!0,afterExpandCheck:!1,allText:"All",oldValue:"",listeners:{focus:function(cpt){cpt.oldValue=cpt.getValue()},keydown:function(cpt,e,eOpts){var value=cpt.getRawValue(),oldValue=cpt.oldValue;value!=oldValue&&cpt.setValue("")}},createPicker:function(){var me=this,picker,menuCls=Ext.baseCSSPrefix+"menu",opts=Ext.apply({pickerField:me,selModel:{mode:me.multiSelect?"SIMPLE":"SINGLE"},floating:!0,hidden:!0,ownerCt:me.ownerCt,cls:me.el.up("."+menuCls)?menuCls:"",store:me.store,displayField:me.displayField,focusOnToFront:!1,pageSize:me.pageSize,tpl:['<ul><tpl for=".">','<li role="option" class="'+Ext.baseCSSPrefix+'boundlist-item yes-harmonized rui-multi-object-picker"><span class="x-combo-checker">&nbsp;</span> {'+me.displayField+"}</li>","</tpl></ul>"]},me.listConfig,me.defaultListConfig);return picker=me.picker=Ext.create("Ext.view.BoundList",opts),me.pageSize&&picker.pagingToolbar.on("beforechange",me.onPageChange,me),me.mon(picker,{itemclick:me.onItemClick,refresh:me.onListRefresh,scope:me}),me.mon(picker.getSelectionModel(),{beforeselect:me.onBeforeSelect,beforedeselect:me.onBeforeDeselect,selectionchange:me.onListSelectionChange,scope:me}),me.store.on("load",function(store){0==store.getTotalCount()?(me.allSelectorHidden=!0,0!=me.allSelector&&me.allSelector.setStyle("display","none"),0!=me.noData&&me.noData.setStyle("display","block")):(me.allSelectorHidden=!1,0!=me.allSelector&&me.allSelector.setStyle("display","block"),0!=me.noData&&me.noData.setStyle("display","none"))}),picker},reset:function(){var me=this;me.setValue("")},setValue:function(value){if(this.value=value,!value)return 0!=this.allSelector&&this.allSelector.removeCls("rui-picker-cb-checked"),this.callParent(arguments);if("string"==typeof value){var me=this,records=[],vals=value.split(",");return""==value?0!=me.allSelector&&me.allSelector.removeCls("rui-picker-cb-checked"):vals.length==me.store.getCount()&&0!=vals.length&&(0!=me.allSelector?me.allSelector.addCls("rui-picker-cb-checked"):me.afterExpandCheck=!0),Ext.each(vals,function(val){var record=me.store.getById(parseInt(val));record&&records.push(record)}),me.setValue(records)}return this.callParent(arguments)},getValue:function(){return"object"==typeof this.value?this.value.join(","):this.value},getSubmitValue:function(){return this.getValue()},expand:function(){var me=this,bodyEl,picker,collapseIf;!me.rendered||me.isExpanded||me.isDestroyed?(me.fireEvent("expand",me),me.onExpand()):(bodyEl=me.bodyEl,picker=me.getPicker(),collapseIf=me.collapseIf,picker.show(),me.isExpanded=!0,me.alignPicker(),bodyEl.addCls(me.openCls),0==me.noData&&(me.noData=picker.getEl().down(".x-boundlist-list-ct").insertHtml("beforeBegin",'<div class="x-boundlist-item yes-harmonized rui-multi-object-picker" role="option">'+me.noDataText+"</div>",!0)),1==me.addAllSelector&&0==me.allSelector&&(me.allSelector=picker.getEl().down(".x-boundlist-list-ct").insertHtml("beforeBegin",'<div class="x-boundlist-item yes-harmonized rui-multi-object-picker" role="option"><span class="x-combo-checker">&nbsp;</span> '+me.allText+"</div>",!0),me.allSelector.on("click",function(e){if(console.log("all click func"),me.allSelector.hasCls("rui-picker-cb-checked"))me.allSelector.removeCls("rui-picker-cb-checked"),me.setValue(""),me.fireEvent("select",me,[]);else{var records=[];me.store.each(function(record){records.push(record)}),me.allSelector.addCls("rui-picker-cb-checked"),me.select(records),me.fireEvent("select",me,records)}}),1==me.allSelectorHidden?me.allSelector.hide():me.allSelector.show(),1==me.afterExpandCheck&&(me.allSelector.addCls("rui-picker-cb-checked"),me.afterExpandCheck=!1)),me.mon(Ext.getDoc(),{mousewheel:collapseIf,mousedown:collapseIf,scope:me}),Ext.EventManager.onWindowResize(me.alignPicker,me),me.fireEvent("expand",me),me.onExpand())},alignPicker:function(){var me=this,picker=me.getPicker();if(me.callParent(),1==me.addAllSelector){var height=picker.getHeight();height=parseInt(height)+20,picker.setHeight(height),picker.getEl().setStyle("height",height+"px")}},onListSelectionChange:function(list,selectedRecords){var me=this,isMulti=me.multiSelect,hasRecords=selectedRecords.length>0;!me.ignoreSelection&&me.isExpanded&&(isMulti||Ext.defer(me.collapse,1,me),(isMulti||hasRecords)&&me.setValue(selectedRecords,!1),hasRecords&&me.fireEvent("select",me,selectedRecords),me.inputEl.focus(),1==me.addAllSelector&&0!=me.allSelector&&(selectedRecords.length==me.store.getTotalCount()?me.allSelector.addCls("rui-picker-cb-checked"):me.allSelector.removeCls("rui-picker-cb-checked")))}});
                function getReleaseTimeBox(app){var timeboxScope=app.getContext().getTimeboxScope(),tbName=null;if(timeboxScope){var record=timeboxScope.getRecord();tbName=record.get("Name")}else tbName="";return tbName}function wsapiQuery(config,callback){Ext.create("Rally.data.WsapiDataStore",{autoLoad:!0,limit:"Infinity",model:config.model,fetch:config.fetch,filters:config.filters,listeners:{scope:this,load:function(store,data){callback(null,data)}}})}function snapshotQuery(config,callback){var storeConfig={find:config.find,fetch:config.fetch,hydrate:config.hydrate,autoLoad:!0,pageSize:1e4,limit:"Infinity",listeners:{scope:this,load:function(store,snapshots,success){console.log("snapshots:",snapshots.length),callback(null,snapshots)}}},snapshotStore=Ext.create("Rally.data.lookback.SnapshotStore",storeConfig)}function pointsUnitType(type){return"Points"==type}function getDefaultSettings(){return{releases:"",epicIds:"",ignoreZeroValues:!0,StoryPoints:!0,StoryPointsProjection:!0,AcceptedStoryPoints:!0,AcceptedPointsProjection:!0,DefectPoints:!0,AccDefectPoints:!0,P0StoryPoints:!0,P0AccStoryPoints:!0,P0StoryPointsProjection:!0,P0AccStoryPointsProjection:!0}}function createSeriesArray(){return[{name:"StoryPoints",description:"Total Points",field:"LeafStoryPlanEstimateTotal",display:"line",f:"sum",color:"DarkGray"},{name:"StoryPointsProjection",description:"Scope Projection",projectOn:"Total Points",color:"LightGray"},{name:"AcceptedStoryPoints",description:"Accepted Points",field:"AcceptedLeafStoryPlanEstimateTotal",display:"line",f:"sum",color:"Green"},{name:"AcceptedPointsProjection",description:"Accepted Projection",projectOn:"Accepted Points",color:"LightGray"},{name:"DefectPoints",description:"Defect Points",field:"PlanEstimate",filterField:"c_Type",filterValues:["DEFECT"],display:"line",f:"filteredSum",color:"Orange"},{name:"AccDefectPoints",description:"Accepted Defect Points",field:"c_AcceptedPlanEstimate",filterField:"c_Type",filterValues:["DEFECT"],display:"line",f:"filteredSum",color:"Blue"},{name:"P0StoryPoints",description:"P0 Points",field:"LeafStoryPlanEstimateTotal",filterField:"c_Priority",filterValues:["P0"],display:"line",f:"filteredSum",color:"Black"},{name:"P0AccStoryPoints",description:"P0 Accepted Points",field:"AcceptedLeafStoryPlanEstimateTotal",filterField:"c_Priority",filterValues:["P0"],display:"line",f:"filteredSum",color:"DarkRed"},{name:"P0StoryPointsProjection",description:"P0 Scope Projection",projectOn:"P0 Points",filterField:"c_Priority",filterValues:["P0"],display:"line",f:"filteredSum",color:"LightGray"},{name:"P0AccPointsProjection",description:"P0 Accepted P0 Projection",projectOn:"P0 Accepted Points",filterField:"c_Priority",filterValues:["P0"],display:"line",f:"filteredSum",color:"LightGray"}]}function createColorsArray(series){var colors=[];return _.each(series,function(s,i){if(i>0){var as=_.find(app.series,function(a){return a.description===s.name});_.isUndefined(as)?colors.push("LightGray"):colors.push(as.color)}}),colors}function trimHighChartsConfig(hc){var today=new Date;return _.each(hc,function(series,i){-1===series.name.indexOf("Projection")&&-1===series.name.indexOf("label")&&_.each(series.data,function(point,x){Date.parse(hc[0].data[x])>today&&(series.data[x]=null)}),-1!==series.name.indexOf("Projection")&&(_.each(series.data,function(point,x){today>Date.parse(hc[0].data[x])&&(series.data[x]=null)}),series.dashStyle="dash")}),hc}
                var app=null;Ext.define("CustomApp",{scopeType:"release",extend:"Rally.app.App",componentCls:"app",itemId:"burnupApp",items:[{xtype:"panel",itemId:"topPanel",layout:{type:"hbox",align:"left"},items:[{xtype:"rallyreleasecombobox",fieldLabel:"Release:",labelAlign:"right",margin:8,width:300,itemId:"releaseCombo",listeners:{ready:function(){var app=this.up("#burnupApp");app.setSelectedRelease(this)},select:function(){var app=this.up("#burnupApp");app.setSelectedRelease(this)}}},{xtype:"rallybutton",itemId:"selectBurnupLinesButton",labelAlign:"right",margin:8,text:"Burnup Display",menu:[{xtype:"menucheckitem",itemId:"milestoneLabels",text:"Milestone Labels",checked:!0,handler:function(checkbox){var showLabels=checkbox.checked;app.removePlotLines("milestone"),app.addPlotLines("milestone",showLabels)}},{xtype:"menucheckitem",itemId:"iterationLabels",text:"Iteration Labels",checked:!0,handler:function(checkbox){var showLabels=checkbox.checked;app.removePlotLines("iterationStart"),app.addPlotLines("iterationStart",showLabels)}},{xtype:"menuseparator"},{xtype:"menucheckitem",itemId:"showP0s",text:"P0 Burnup Lines",checked:!1,handler:function(checkbox,showLabels){app.createAndShowBurnupChart()}},{xtype:"menucheckitem",itemId:"showDefects",text:"Defect Burnup Lines",checked:!1,handler:function(checkbox,showLabels){app.createAndShowBurnupChart()}},{xtype:"menucheckitem",itemId:"showProjections",text:"Completion Projection Lines",checked:!1,handler:function(checkbox,showLabels){app.createAndShowBurnupChart()}}]},{xtype:"rallybutton",itemId:"selectFeatureButton",labelAlign:"right",margin:8,text:"Burnup Components",listeners:{menuhide:function(button,event,eOpts){app.displayFeatureSelection()},click:function(button,event,eOpts){if(!app.featureRecords){var release=app.releases&&app.releases[0],relName=release&&release.get("Name");button.menu.setLoading(!0),app.featureToNameMap={};var config={model:app.featureType,fetch:["Name","FormattedID","LeafStoryPlanEstimateTotal","AcceptedLeafStoryPlanEstimateTotal"],filters:[{property:"Release.Name",operator:"=",value:relName}]};app.wsapiQuery(config,function(err,featureRecords){featureRecords=_.sortBy(featureRecords,function(rec){var tot=rec.get("LeafStoryPlanEstimateTotal"),done=rec.get("AcceptedLeafStoryPlanEstimateTotal"),rem=tot-done;return-rem}),_(featureRecords).forEach(function(featureRecord){var name=featureRecord.get("Name"),id=featureRecord.get("FormattedID"),totalPoints=featureRecord.get("LeafStoryPlanEstimateTotal"),donePoints=featureRecord.get("AcceptedLeafStoryPlanEstimateTotal"),remPoints=totalPoints-donePoints;app.featureToNameMap[id]=name,button.menu.add({text:"<b>"+id+"</b>: "+name+' <span style="font-size:9px">('+remPoints+": "+donePoints+"/"+totalPoints+")</span>",xtype:"menucheckitem",value:id,checked:!0,listeners:{checkHandler:function(checkbox){checkbox.checked?app.setCheckbox("selectNone",!1):app.setCheckbox("selectAll",!1)}}})}),app.featureRecords=featureRecords,button.menu.setLoading(!1)})}}},menu:[{xtype:"menucheckitem",text:"Select All",itemId:"selectAll",checked:!0,handler:function(checkbox){var checked=checkbox.checked;checked&&app.setAllInSelectMenu(!0)}},{xtype:"menucheckitem",text:"Select None",itemId:"selectNone",handler:function(checkbox){var checked=checkbox.checked;checked&&app.setAllInSelectMenu(!1)}},{xtype:"menuseparator"},{xtype:"menucheckitem",text:"Include Defects",itemId:"includeDefects",handler:function(checkbox){var checked=checkbox.checked;checked?app.setCheckbox("selectNone",!1):app.setCheckbox("selectAll",!1)},checked:!0},{xtype:"menuseparator"}]}]},{xtype:"panel",layout:"fit",items:[{xtype:"panel",itemId:"chartPanel",layout:"fit",minHeight:500,minWidth:100}]},{xtype:"panel",itemId:"gridPanel",layout:{type:"hbox",align:"left"}}],displayFeatureSelection:function(){var button=app.down("#selectFeatureButton"),menuItems=button.menu.items.items,selectedFeatures=[],ignoredFeatures=[];_(menuItems).forEach(function(menuItem){menuItem.value&&menuItem.checked?selectedFeatures.push(menuItem.value):menuItem.value&&!menuItem.checked&&ignoredFeatures.push(menuItem.value)}),app.selectedFeatures=selectedFeatures,app.ignoredFeatures=ignoredFeatures,app.createAndShowBurnupChart()},resetFeatureSelection:function(){this.selectedFeatures=null,this.ignoredFeatures=null,this.featureRecords=null},allFeaturesSelected:function(){var button=app.down("#selectFeatureButton"),menu=button.menu,allSelected=!0;return _(menu.items.items).forEach(function(menuItem){menuItem.value&&0==menuItem.checked&&(allSelected=!1)}),allSelected},setAllInSelectMenu:function(selectValue){var button=app.down("#selectFeatureButton"),menu=button.menu;_(menu.items.items).forEach(function(menuItem){var text=menuItem.text;"menuseparator"==menuItem.xtype||("Select None"==text?selectValue&&menuItem.setChecked(!1):menuItem.setChecked(selectValue))})},getCheckboxValue:function(checkBoxId){var checkbox=this.down("#"+checkBoxId);return checkbox.checked},setCheckbox:function(checkBoxId,value){var checkbox=this.down("#"+checkBoxId);checkbox.setChecked(value)},milestoneLabels:function(){return this.getCheckboxValue("milestoneLabels")},iterationLabels:function(){return this.getCheckboxValue("iterationLabels")},showP0s:function(){return this.getCheckboxValue("showP0s")},showDefects:function(){return this.getCheckboxValue("showDefects")},showProjections:function(){return this.getCheckboxValue("showProjections")},onlyP0s:function(){return!1},includeDefects:function(){return this.getCheckboxValue("includeDefects")},setSelectedRelease:function(releaseCombo){var releaseName=releaseCombo.getRecord().data.Name;this.defaultRelease=releaseName,this.resetFeatureSelection(),this.resetData(),this.createChart()},getTestPicker:function(){Ext.Loader.setConfig({enabled:!0}),Ext.Loader.setPath("Ext.ux","/ux");var store=Ext.create("Ext.data.Store",{fields:["id","type"],data:[{id:"1",type:"option one"},{id:"2",type:"option two"},{id:"3",type:"option three"},{id:"4",type:"option four"},{id:"5",type:"option five"},{id:"6",type:"option six"},{id:"7",type:"option seven"}]});return{xtype:"rallymultiobjectpicker",fieldLabel:"Include In Burnup:",labelAlign:"right",rowSelectable:!0,margin:8,listCfg:{selModel:{mode:"SIMPLE"},displayField:"type",pageSize:0,autoScroll:!0,cls:"rui-multi-object-list"},store:store,listeners:{scope:this}}},launch:function(){this.velocityCalc=new VelocityCalculator(this)},config:{defaultSettings:getDefaultSettings()},getSettingsFields:function(){var checkValues=_.map(createSeriesArray(),function(s){return{name:s.name,xtype:"rallycheckboxfield",label:s.description}}),values=[{name:"releases",xtype:"rallytextfield",label:"Release names to be included (comma seperated)"},{name:"epicIds",xtype:"rallytextfield",label:"(Optional) List of Parent PortfolioItem (Epics) ids to filter Features by"},{name:"featureIds",xtype:"rallytextfield",label:"(Optional) List of PortfolioItem ids to exclusively show"},{name:"ignoreZeroValues",xtype:"rallycheckboxfield",label:"For projection ignore zero values"}];return _.each(values,function(value){value.labelWidth=250,value.labelAlign="left"}),values.concat(checkValues)},createChart:function(){if(app||(app=this),app.setLoading(!0),app.series=createSeriesArray(),app.configReleases=app.getSetting("releases")||app.defaultRelease,app.ignoreZeroValues=app.getSetting("ignoreZeroValues"),app.epicIds=app.getSetting("epicIds"),""===app.configReleases)return this.resetChart("Please Configure this app by selecting Edit App Settings from Configure (gear) Menu"),void 0;this.project=this.getContext().getProject().ObjectID;var tbName=getReleaseTimeBox(this);app.configReleases=""!==tbName?tbName:app.configReleases;var configs=[];configs.push({model:"Release",fetch:["Name","ObjectID","Project","ReleaseStartDate","ReleaseDate"],filters:[app.createReleaseFilter(app.configReleases)]}),configs.push({model:"TypeDefinition",fetch:!0,filters:[{property:"Ordinal",operator:"=",value:0}]}),configs.push({model:"Milestone",fetch:["Name","TargetDate","DisplayColor"],filters:[Ext.create("Rally.data.QueryFilter",{property:"Projects",operator:"contains",value:"project/"+this.project}).or(Ext.create("Rally.data.QueryFilter",{property:"TargetProject",operator:"=",value:null})).and(Ext.create("Rally.data.QueryFilter",{property:"TargetDate",operator:"!=",value:null}))],sorters:[{property:"TargetDate",direction:"DESC"}]}),async.map(configs,app.wsapiQuery,function(err,results){return app.releases=results[0],app.featureType=results[1][0].get("TypePath"),app.milestones=results[2],0===app.releases.length?(app.resetChart("No Releases found with this name: "+app.configReleases),void 0):(configs=[{model:"Iteration",fetch:["Name","ObjectID","Project","StartDate","EndDate"],filters:app.createIterationFilter(app.releases)}],async.map(configs,app.wsapiQuery,function(err,results){app.iterations=results[0];var includeDefects=app.includeDefects();includeDefects&&app.defectSnapshots||!includeDefects&&app.featureSnapshots?app.createAndShowBurnupChart():app.queryFeatureSnapshots()}),void 0)})},trimString:function(str){return str.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},createReleaseFilter:function(releaseNames){var filter=null;return _.each(releaseNames.split(","),function(releaseName,i){if(""!==releaseName){var f=Ext.create("Rally.data.wsapi.Filter",{property:"Name",operator:"=",value:app.trimString(releaseName)});filter=0===i?f:filter.or(f)}}),console.log("Release Filter:",""+filter),filter},createIterationFilter:function(releases){var extent=app.getReleaseExtent(releases),filter=Ext.create("Rally.data.wsapi.Filter",{property:"EndDate",operator:">=",value:extent.isoStart});return filter=filter.and(Ext.create("Rally.data.wsapi.Filter",{property:"EndDate",operator:"<=",value:extent.isoEnd}))},getReleaseExtent:function(releases){var start=_.min(_.pluck(releases,function(r){return r.get("ReleaseStartDate")})),end=_.max(_.pluck(releases,function(r){return r.get("ReleaseDate")})),isoStart=Rally.util.DateTime.toIsoString(start,!1),isoEnd=Rally.util.DateTime.toIsoString(end,!1);return{start:start,end:end,isoStart:isoStart,isoEnd:isoEnd}},wsapiQuery:function(config,callback){Ext.create("Rally.data.WsapiDataStore",{autoLoad:!0,limit:"Infinity",model:config.model,fetch:config.fetch,filters:config.filters,listeners:{scope:this,load:function(store,data){callback(null,data)}},sorters:config.sorters})},resetData:function(){delete this.defectSnapshots,delete this.featureSnapshots},resetChart:function(mesg){app.setLoading(!1);var chart=app.down("#chart1");null!==chart&&chart.removeAll(),mesg?Rally.ui.notify.Notifier.show({message:mesg,color:"red"}):Rally.ui.notify.Notifier.hide()},executeFeatureQuery:function(filter){return Ext.create("Rally.data.WsapiDataStore",{autoLoad:!0,model:app.featureType,limit:"Infinity",fetch:["ObjectID","FormattedID"],filters:[filter],listeners:{load:function(store,features){console.log("Loaded:"+features.length," Features."),app.features=features,0===app.features.length?app.resetChart("No features found for this release"):app.queryFeatureSnapshots()}}})},queryEpicFeatures:function(){var filter=null,epicIds=app.epicIds.split(",");return 0===epicIds.length?(app.resetChart("No epic id's specified"),void 0):(_.each(epicIds,function(epicId,i){var f=Ext.create("Rally.data.QueryFilter",{property:"Parent.FormattedID",operator:"=",value:epicId});filter=0===i?f:filter.or(f)}),app.executeFeatureQuery(filter),void 0)},queryFeatures:function(){var filter=null,releaseNames=_.uniq(_.map(app.releases,function(r){return r.get("Name")}));console.log("releaseNames",releaseNames),_.each(releaseNames,function(release,i){var f=Ext.create("Rally.data.QueryFilter",{property:"Release.Name",operator:"=",value:release});filter=0===i?f:filter.or(f)}),app.executeFeatureQuery(filter)},getSpecificFeatureIds:function(){var features=!app.allFeaturesSelected()&&app.selectedFeatures;return features},getSnapshotFilters:function(type){var extent=app.getReleaseExtent(app.releases),relIDs=_.map(app.releases,function(release){return release.data.ObjectID}),filters;if("defect"===type)filters={_TypeHierarchy:{$in:["Defect"]},Release:{$in:relIDs},PlanEstimate:{$gt:0},_ValidTo:{$gte:extent.isoStart}};else{filters={_TypeHierarchy:{$in:[app.featureType]},Release:{$in:relIDs},_ValidTo:{$gte:extent.isoStart}};var featureIds=this.getSpecificFeatureIds();featureIds?filters.FormattedID={$in:featureIds}:filters.Release={$in:relIDs},app.onlyP0s()&&(filters.c_Priority={$in:["P0"]})}return filters},queryFeatureSnapshots:function(){var defectStoreFilters=this.getSnapshotFilters("defect"),defectStoreConfig={find:defectStoreFilters,autoLoad:!0,pageSize:1e3,limit:"Infinity",fetch:["PlanEstimate","ScheduleState"],hydrate:["ScheduleState"],listeners:{load:function(store,snapshots,success){snapshots&&console.log("Loaded:"+snapshots.length," Defects snapshots",success),success===!1&&Rally.ui.notify.Notifier.show({message:"Failed to load defect data"}),app.gotSnapshotData("defects",snapshots)}}},featureStoreFilters=this.getSnapshotFilters("feature"),featureStoreConfig={find:featureStoreFilters,autoLoad:!0,pageSize:1e3,limit:"Infinity",fetch:["LeafStoryPlanEstimateTotal","AcceptedLeafStoryPlanEstimateTotal","c_Priority","FormattedID"],hydrate:["c_Priority"]};featureStoreConfig.listeners={scope:this,load:function(store,snapshots,success){console.log("Loaded:"+snapshots.length," Feature Snapshots.",success),success===!1&&Rally.ui.notify.Notifier.show({message:"Failed to load user story data"}),app.gotSnapshotData("features",snapshots)}},this.featureSnapshots||(console.log("Querying for feature snapshots",featureStoreConfig.find),Ext.create("Rally.data.lookback.SnapshotStore",featureStoreConfig)),this.includeDefects()&&(console.log("Querying for defects snapshots",defectStoreConfig.find),Ext.create("Rally.data.lookback.SnapshotStore",defectStoreConfig))},normalizeDefectSnapshotData:function(defectSnapshots){return app.defectTotalPoints=0,app.defectAcceptedPoints=0,_(defectSnapshots).forEach(function(defect){var planEstimate=defect.data.PlanEstimate;defect.data.LeafStoryPlanEstimateTotal=planEstimate,defect.data.c_Priority="P0",defect.data.c_Type="DEFECT",app.defectTotalPoints+=planEstimate,"Accepted"===defect.data.ScheduleState&&(app.defectAcceptedPoints+=planEstimate),defect.data.AcceptedLeafStoryPlanEstimateTotal="Accepted"===defect.data.ScheduleState?defect.data.PlanEstimate:0,defect.data.c_AcceptedPlanEstimate="Accepted"===defect.data.ScheduleState?defect.data.PlanEstimate:0}),defectSnapshots},gotSnapshotData:function(type,snapshots){"defects"==type?app.defectSnapshots=app.normalizeDefectSnapshotData(snapshots):"features"==type&&(app.featureSnapshots=snapshots),app.includeDefects()&&!app.defectSnapshots||!app.featureSnapshots||app.createAndShowBurnupChart()},getFilterIdMap:function(){var featureIds=this.getSpecificFeatureIds(),map=null;return featureIds&&(map={},_(featureIds).forEach(function(fid){map[fid]=1})),map},filterSnapShotFeatureData:function(snapShotData){var filterMap=this.getFilterIdMap(),filteredData=[];return null==filterMap?filteredData=snapShotData:_(snapShotData).forEach(function(snapShot){(!snapShot.FormattedID||filterMap[snapShot.FormattedID])&&filteredData.push(snapShot)}),filteredData},createAndShowBurnupChart:function(){var snapshots=this.includeDefects()&&app.defectSnapshots?app.featureSnapshots.concat(app.defectSnapshots):app.featureSnapshots,lumenize=window.parent.Rally.data.lookback.Lumenize,snapShotData=this.filterSnapShotFeatureData(_.map(snapshots,function(d){return d.data})),extent=app.getReleaseExtent(app.releases),holidays=[],myCalc=Ext.create("MyBurnCalculator",{series:app.series,ignoreZeroValues:app.ignoreZeroValues,peRecords:app.peRecords}),config={deriveFieldsOnInput:myCalc.getDerivedFieldsOnInput(),metrics:myCalc.getMetrics(),summaryMetricsConfig:[],deriveFieldsAfterSummary:myCalc.getDerivedFieldsAfterSummary(),granularity:lumenize.Time.DAY,tz:"America/Chicago",holidays:holidays,workDays:"Monday,Tuesday,Wednesday,Thursday,Friday,Saturday,Sunday"},startOnISOString=new lumenize.Time(extent.start).getISOStringInTZ(config.tz),upToDateISOString=new lumenize.Time(extent.end).getISOStringInTZ(config.tz);calculator=new lumenize.TimeSeriesCalculator(config),calculator.addSnapshots(snapShotData,startOnISOString,upToDateISOString);var hcConfig=[{name:"label"}];_.each(app.series,function(s){if(app.getSetting(s.name)===!0){var desc=s.description;desc.match("P0")&&!app.showP0s()||desc.match("Defect")&&!app.showDefects()||desc.match("Projection")&&!app.showProjections()||hcConfig.push({name:s.description,type:s.display})}});var seriesData=calculator.getResults().seriesData,hc=lumenize.arrayOfMaps_To_HighChartsSeries(seriesData,hcConfig);this.showChart(trimHighChartsConfig(hc)),this.velocityCalc.addGrids(seriesData,app.milestones,app.iterations)},getChartXAxis:function(){var chart=app.down("highchart").chart,xAxisArray=chart.xAxis;return xAxisArray[0]},removePlotLines:function(labelHead){var xAxis=this.getChartXAxis(),plotLines=xAxis.plotLinesAndBands,ids=[];_(plotLines).forEach(function(plotLine){plotLine&&plotLine.id.match(labelHead+"-")&&ids.push(plotLine.id)}),_(ids).forEach(function(id){xAxis.removePlotLine(id)})},addPlotLines:function(plotLineType,showLabelTitles){var xAxis=this.getChartXAxis(),plotLines="milestone"==plotLineType?this.getMilestonePlotLineConfigs(app.seriesDates,showLabelTitles):this.getIterationPlotLineConfigs(app.seriesDates,showLabelTitles,"start");_(plotLines).forEach(function(plotLine){xAxis.addPlotLine(plotLine)})},getPlotLineConfigs:function(seriesDates,recordArray,dateField,plotLineStyle){var plotLineCount=1,plotLineType=plotLineStyle.plotLineType||"unknown",plotLineConfigs=_.map(recordArray,function(record){var date=new Date(Date.parse(record.raw[dateField])),dateStr=date.toISOString().split("T")[0],color=plotLineStyle.color||record.get("DisplayColor")||"grey",labelHTML='<span style="font-family:Rally;color:'+color+'">8</span>',labelTitle=record.get("Name"),plotLineConfig={dashStyle:"Dot",color:color,width:1,value:_.indexOf(seriesDates,dateStr)};if("milestone"==plotLineType){var text=labelHTML,yLabelOffset=-1;plotLineStyle.showLabelTitles&&(text+=labelTitle,plotLineCount%2&&(yLabelOffset=15)),plotLineConfig.label={text:text,rotation:0,verticalAlign:"top",x:-6,y:yLabelOffset,textAlign:"left",useHTML:!0},plotLineCount++}else"iterationStart"==plotLineType&&plotLineStyle.showLabelTitles&&(plotLineConfig.label={text:labelTitle,rotation:270,y:-5,x:10,verticalAlign:"bottom"});if(plotLineType){var name=record.get("Name"),plotLineId=plotLineType+"-"+name;plotLineConfig.id=plotLineId,plotLineConfig.events={click:function(){var axis=this.axis;axis.removePlotLine(plotLineId)}}}return _.each(plotLineStyle,function(value,key){plotLineConfig[key]=value},this),plotLineConfig});return plotLineConfigs},getMilestonePlotLineConfigs:function(seriesDates,showLabelTitles){var plotLineStyle={dashStyle:"dash",width:2,showLabel:!0,showLabelTitles:showLabelTitles,plotLineType:"milestone"};return this.getPlotLineConfigs(seriesDates,this.milestones,"TargetDate",plotLineStyle)},getIterationPlotLineConfigs:function(seriesDates,showLabelTitles,type){var plotLineType="start"==type?"iterationStart":"iterationEnd",dateField="start"==type?"StartDate":"EndDate",start=new Date(Date.parse(seriesDates[0])),end=new Date(Date.parse(seriesDates[seriesDates.length-1])),iterations=_.filter(this.iterations,function(i){return i.get("EndDate")>=start&&end>=i.get("EndDate")});iterations=_.uniq(iterations,function(i){return i.get("Name")});var plotLineStyle={dashStyle:"dot",color:"grey",showLabelTitles:showLabelTitles,plotLineType:plotLineType};return this.getPlotLineConfigs(seriesDates,iterations,dateField,plotLineStyle)},getAllPlotLineConfigs:function(seriesDates){var itPlotLines=this.getIterationPlotLineConfigs(seriesDates,this.iterationLabels,"start"),itEPlotLines=this.getIterationPlotLineConfigs(seriesDates,!1,"end"),rePlotLines=this.getPlotLineConfigs(seriesDates,this.selectedReleases,"ReleaseDate",{dashStyle:"dot",color:"grey"}),miPlotLines=this.getMilestonePlotLineConfigs(seriesDates,this.milestoneLabels);return itPlotLines.concat(itEPlotLines).concat(rePlotLines).concat(miPlotLines)},getChartTitle:function(){var title="",fids=app.getSpecificFeatureIds();if(fids&&0==fids.length)title=this.includeDefects()?"Only showing Defects":"No features or defects selected";else if(fids){var ignored=app.ignoredFeatures||[];fids.length<=ignored.length?(title=1==fids.length?"Limited to feature "+fids[0]+": "+this.featureToNameMap[fids[0]]:"Limited to features: "+fids.join(", "),this.includeDefects()&&(title+=" and Defects")):(title=1==ignored.length?"Excluding feature "+ignored[0]+": "+this.featureToNameMap[ignored[0]]:"Excluding features: "+ignored.join(", "),this.includeDefects()||(title+=" and Defects"))}else this.includeDefects()||(title+="Not showing Defects");return""==title&&(title=" "),title},showChart:function(series){app.resetChart(),app.seriesDates=series[0].data;var plotlines=this.getAllPlotLineConfigs(app.seriesDates),tickInterval=140>=series[1].data.length?7:series[1].data.length/20,title=this.getChartTitle(),extChart=Ext.create("Rally.ui.chart.Chart",{columnWidth:1,itemId:"chart1",chartData:{categories:series[0].data,series:series.slice(1,series.length)},chartColors:createColorsArray(series),chartConfig:{chart:{},title:{text:title,x:-20},plotOptions:{series:{marker:{radius:2}}},xAxis:{plotLines:plotlines,tickInterval:tickInterval,type:"datetime",labels:{formatter:function(){return Highcharts.dateFormat("%b %d",Date.parse(this.value))}}},yAxis:{title:{text:"Points/Count"},plotLines:[{value:0,width:1,color:"#808080"}]},tooltip:{},legend:{align:"center",verticalAlign:"bottom"},renderTo:Ext.getBody()}}),panel=app.down("#chartPanel");panel.add(extChart),app.clearLoadingBug()},clearLoadingBug:function(){var p=Ext.get(this.id),elems=p.query("div.x-mask").concat(p.query("div.x-mask-msg"));_.each(elems,function(e){if("function"==typeof e.remove)e.remove();else if("function"==typeof e.removeNode){for(;e.firstChild;)e.removeChild(e.firstChild);e.removeNode()}})}});
                Ext.define("MyBurnCalculator",function(){var self;return{extend:"Rally.data.lookback.calculator.TimeSeriesCalculator",config:{series:[],ignoreZeroValues:!0,peRecords:[]},constructor:function(config){return self=this,this.initConfig(config),this},pointsOffset:[],countOffset:[],data:[],indexOffset:[],getMetrics:function(){var nonProjectionMetrics=_.filter(self.series,function(s){return-1==s.name.indexOf("Projection")}),metrics=_.map(nonProjectionMetrics,function(m){var row={field:m.field,as:m.description,display:m.display,f:m.f};return m.filterField&&(row.filterField=m.filterField,row.filterValues=m.filterValues),row});return metrics},getDerivedFieldsOnInput:function(){return[{as:"CalcPreliminaryEstimate",f:function(row){var r=_.find(self.peRecords,function(rec){return rec.get("ObjectID")==row.PreliminaryEstimate}),v=void 0!==r?r.get("Value"):0;return v}},{as:"Completed",f:function(row){return 1==row.PercentDoneByStoryCount?1:0}}]},getMidPointIndex:function(dateSeries){var today=new Date,tdi=_.findIndex(dateSeries,function(d){return today.setHours(0,0,0,0)===new Date(Date.parse(d)).setHours(0,0,0,0)});return-1!==tdi?Math.round(tdi/2):-1},calcProjectionPoint:function(seriesName,projectOn,row,index,summaryMetrics,seriesData,projectFrom){var that=this;if(0===index){datesData=_.pluck(seriesData,"label");var mid=self.getMidPointIndex(datesData),today=new Date,li=datesData.length-1;that.data[seriesName]=_.pluck(seriesData,projectOn),that.data[seriesName]=_.filter(that.data[seriesName],function(d,i){return _.isUndefined(projectFrom)||"mid"!==projectFrom?today>new Date(Date.parse(datesData[i])):mid>i});var dx=that.data[seriesName].length;self.ignoreZeroValues===!0&&(that.data[seriesName]=_.filter(that.data[seriesName],function(d,i){return 0!==d}));var dy=that.data[seriesName].length;that.indexOffset[seriesName]=dx-dy;var lastAccepted=that.data[seriesName][that.data[seriesName].length-1],lastProjected=linearProject(that.data[seriesName],that.data[seriesName].length-1);that.pointsOffset[seriesName]=lastAccepted-lastProjected}index-=that.indexOffset[seriesName];var y=linearProject(that.data[seriesName],index)+that.pointsOffset[seriesName];return Math.round(100*y)/100},getDerivedFieldsAfterSummary:function(){var projectionMetrics=_.filter(self.series,function(s){return-1!==s.name.indexOf("Projection")}),metrics=_.map(projectionMetrics,function(m){return{as:m.description,projectOn:m.projectOn,projectFrom:m.projectFrom,name:m.name,f:function(row,index,summaryMetrics,seriesData){var p=self.calcProjectionPoint(this.name,this.projectOn,row,index,summaryMetrics,seriesData,this.projectFrom);return p}}});return metrics},defined:function(v){return!_.isUndefined(v)&&!_.isNull(v)}}});
                function LineFitter(){this.count=0,this.sumX=0,this.sumX2=0,this.sumXY=0,this.sumY=0}function linearProject(data,x){for(var fitter=new LineFitter,i=0;data.length>i;i++)fitter.add(i,data[i]);return fitter.project(x)}function projectToZero(data,x){for(var start=x;linearProject(data,start)>0;)start+=1;return start}LineFitter.prototype={add:function(x,y){this.count++,this.sumX+=x,this.sumX2+=x*x,this.sumXY+=x*y,this.sumY+=y},project:function(x){var det=this.count*this.sumX2-this.sumX*this.sumX,offset=(this.sumX2*this.sumY-this.sumX*this.sumXY)/det,scale=(this.count*this.sumXY-this.sumX*this.sumY)/det;return offset+x*scale}};
                Ext.define("VelocityCalculator",{app:null,gridPanelId:"#gridPanel",storeFields:["startName","endName","days","acceptVelocity","acceptDelta","scopeVelocity","scopeDelta","acceptPoints","accPointsPerMo","segmentVelPerMo","segmentVel"],constructor:function(theApp){return this.app=theApp,this},today:function(){return Ext.Date.format(new Date,"Y-m-d")},resetPanel:function(){var panel=this.app.down(this.gridPanelId);null!==panel&&panel.removeAll()},addGridsToPanel:function(grids){var panel=this.app.down(this.gridPanelId);_.each(grids,function(newGrid){panel.add(newGrid)}),panel.update()},addGrids:function(seriesData,milestones,iterations){this.resetPanel(),this.createDateCollection(seriesData),this.addGridsToPanel([this.getOverallVelocityGrid(seriesData),this.getIterationVelocityGrid(seriesData,iterations),this.getMilestoneVelocityGrid(seriesData,milestones)])},calcDoneDate:function(totalPoints,acceptedPoints,avgMoVelocity){var avgDayVelocity=avgMoVelocity.match(/^\d+(\.\d+)?$/)?Math.round(avgMoVelocity/30):"",daysToFinish=avgDayVelocity?Math.round((totalPoints-acceptedPoints)/avgDayVelocity):"",doneDate=""===daysToFinish?"n/a":Ext.Date.format(Ext.Date.add(new Date,Ext.Date.DAY,daysToFinish),"Y-m-d");return doneDate},calcPct:function(num,total){var pct=total?Math.round(100*(num/total)):"-";return pct},addPctToNum:function(num,total){var pct=this.calcPct(num,total);return num+" ("+pct+"%)"},getOverallStats:function(seriesData,P0){var entryCount=seriesData.length-1,firstEntry=seriesData[0],lastEntry=seriesData[entryCount],startDate=firstEntry.label,endDate=lastEntry.label,today=this.today(),compDate=endDate>today?today:endDate,acceptField=P0===!0?"P0 Accepted Points":"Accepted Points",storyField=P0===!0?"P0 Points":"Total Points",startAccPoints=Math.round(firstEntry[acceptField]),acceptedPoints=Math.round(lastEntry[acceptField]),curAccPoints=acceptedPoints-startAccPoints,totalPoints=Math.round(lastEntry[storyField]),remainingPoints=totalPoints-curAccPoints,totalDays=this.subtractDates(endDate,startDate),daysPast=this.subtractDates(compDate,startDate),monthsPast=daysPast/30,daysPct=totalDays?Math.round(100*(daysPast/totalDays))+"%":"-",avgMoVelocity=monthsPast?""+Math.round(curAccPoints/monthsPast):"-",doneDate=this.calcDoneDate(totalPoints,acceptedPoints,avgMoVelocity);return{avgMoVelocity:avgMoVelocity,totalPoints:totalPoints,acceptedPoints:acceptedPoints,remainingPoints:this.addPctToNum(remainingPoints,totalPoints),daysPct:daysPct,doneDate:doneDate}},getOverallVelocityGrid:function(seriesData){var totalStats=this.getOverallStats(seriesData,!1),p0Stats=this.getOverallStats(seriesData,!0),getEditorFunc=function(record){var edit=record&&record.get("edit"),formType="Ext.form.field.Number",formConfig=null;return edit===!0?Ext.create("Ext.grid.CellEditor",{field:Ext.create(formType,formConfig)}):null},stats=[{stat:"Avg. Velocity / Month",value:totalStats.avgMoVelocity,P0Value:p0Stats.avgMoVelocity,edit:!0},{stat:"Total Points",value:totalStats.totalPoints,P0Value:p0Stats.totalPoints,edit:!0},{stat:"Accepted Points",value:totalStats.acceptedPoints,P0Value:p0Stats.acceptedPoints},{stat:"Remaining Points",value:totalStats.remainingPoints,P0Value:p0Stats.remainingPoints},{stat:"% Time Used",value:totalStats.daysPct,P0Value:p0Stats.daysPct},{stat:"Completion Estimate",value:totalStats.doneDate,P0Value:p0Stats.doneDate}],store=Ext.create("Ext.data.Store",{storeId:"overallVelocityStore",fields:["stat","value","P0Value","edit"],data:{items:stats},proxy:{type:"memory",reader:{type:"json",root:"items"}}}),that=this,newGrid=Ext.create("Ext.grid.Panel",{title:"Overall Stats",itemId:"velocityStatsGrid",store:store,columns:[{text:"Statistic",dataIndex:"stat",flex:200,align:"right"},{text:"All",dataIndex:"value",getEditor:getEditorFunc},{text:"P0 Only",dataIndex:"P0Value",getEditor:getEditorFunc}],plugins:[{ptype:"cellediting",clicksToEdit:1,listeners:{edit:function(editor,e){if(console.log("we were edited",e),e.value!=e.originalValue){var grid=e.grid,field=e.field,models=grid.getStore().getRange(),velocity=""+models[0].get(field),totPoints=""+models[1].get(field),accPoints=""+models[2].get(field),remPoints=this.addPctToNum(totPoints-accPoints,totPoints);console.log("calc",totPoints,accPoints,velocity);var doneDate=that.calcDoneDate(totPoints,accPoints,velocity);models[5].set(field,doneDate),models[3].set(field,remPoints)}},scope:this}}],width:400,renderTo:Ext.getBody()});return newGrid},createDateCollection:function(seriesData){var dateCollection={};return _.each(seriesData,function(pointData){var date=pointData.label;dateCollection[date]=pointData}),this.dateCollection=dateCollection},todayPointData:function(){var today=this.today();return this.dateCollection[today]},addVelocitySegmentEntry:function(items,name,nextName,date,nextDate){var pointData=date&&this.dateCollection[date],nextPointData=nextDate&&this.dateCollection[nextDate];if(this.dateIsFuture(date));else if(pointData&&nextPointData){if(nextDate>this.today()){var todayPointData=this.todayPointData();todayPointData&&(nextPointData=this.todayPointData(),nextDate=this.today())}var acceptedDiff=nextPointData["Accepted Points"]-pointData["Accepted Points"],scopeDiff=nextPointData["Total Points"]-pointData["Total Points"],days=this.subtractDates(nextDate,date),months=days/30;_.isNaN(acceptedDiff)||items.push({startName:name,endName:nextName+" ("+days+" days)",days:days,segmentVel:Math.round(acceptedDiff-scopeDiff),segmentVelPerMo:months?Math.round(100*((acceptedDiff-scopeDiff)/months))/100:"-",acceptPoints:Math.round(acceptedDiff),accPointsPerMo:months?Math.round(100*(acceptedDiff/months))/100:"-",acceptDelta:this.velocityStr(acceptedDiff,months),scopeDelta:this.velocityStr(scopeDiff,months),effectiveVel:this.velocityStr(acceptedDiff-scopeDiff,months)})}},getIterationItems:function(iterations,seriesData){var items=[],that=this,today=this.today(),uniqIterations=_.sortBy(_.uniq(_.map(iterations,function(i){return i.raw}),"Name"),"StartDate");return _.each(uniqIterations,function(iteration){var date=iteration.StartDate.replace(/T.*/,""),nextDate=iteration.EndDate.replace(/T.*/,""),name=iteration.Name,nextName=name;that.addVelocitySegmentEntry(items,name,nextName,date,nextDate)}),items},getIterationVelocityGrid:function(seriesData,iterations){var items=this.getIterationItems(iterations,seriesData),store=Ext.create("Ext.data.Store",{storeId:"iterationVelocityStore",fields:this.storeFields,data:{items:items},proxy:{type:"memory",reader:{type:"json",root:"items"}}}),newGrid=Ext.create("Ext.grid.Panel",{title:"Iteration Velocities",itemId:"iterationVelocitiesGrid",store:store,columns:[{text:"Iteration",dataIndex:"endName",flex:300,align:"right",hidden:!1},{text:"Accepted Points",dataIndex:"acceptPoints",hidden:!1},{text:"Acc / Month",dataIndex:"accPointsPerMo",hidden:!1},{text:"Effective Velocity",dataIndex:"segmentVel",hidden:!0},{text:"Scope Change",dataIndex:"scopeDelta",hidden:!0}],width:400,renderTo:Ext.getBody()});return newGrid},getMilestoneVelocityGrid:function(seriesData,milestones){this.milestones=milestones;var items=this.getMilestoneItems(seriesData),store=Ext.create("Ext.data.Store",{storeId:"milestoneVelocityStore",fields:this.storeFields,data:{items:items},proxy:{type:"memory",reader:{type:"json",root:"items"}}}),newGrid=Ext.create("Ext.grid.Panel",{title:"Milestone Segment Velocities",itemId:"milestoneVelocitiesGrid",store:store,columns:[{text:"Segment Start",dataIndex:"startName",flex:200,hidden:!0},{text:"Segment End",dataIndex:"endName",flex:200,align:"right"},{text:"Segment Velocity",dataIndex:"segmentVel"},{text:"SV / Month",dataIndex:"segmentVelPerMo"},{text:"Accepted Points",dataIndex:"acceptDelta",hidden:!0},{text:"Scope Change",dataIndex:"scopeDelta",hidden:!0}],width:400,renderTo:Ext.getBody()});return newGrid},initializeMilestoneSegments:function(seriesData){var start=seriesData[0],startDate=start.label,end=seriesData[seriesData.length-1],endDate=end.label,milestoneDates={};return milestoneDates[startDate]={pointData:start,milestoneList:[{Name:"Start of Release"}]},milestoneDates[endDate]={pointData:end,milestoneList:[{Name:"End of Release"}]},milestoneDates[startDate].pointData.nextDate=endDate,milestoneDates},populateMilestoneSegmentDates:function(seriesData){var milestoneDates=this.initializeMilestoneSegments(seriesData),relStartDate=seriesData[0].label,end=seriesData[seriesData.length-1],relEndDate=end.label,today=Ext.Date.format(new Date,"Y-m-d"),that=this,lastDate=relStartDate;return _.every(this.milestones.reverse(),function(milestone){var data=milestone.raw,date=data.TargetDate.replace(/T.*/,"");if(date>today&&(data.Name="Today - "+today),date>relStartDate&&relEndDate>date){var dateInfo=milestoneDates[date];dateInfo||(dateInfo=milestoneDates[date]={pointData:{},milestoneList:[]}),dateInfo.milestoneList.push(data),lastDate&&(milestoneDates[lastDate].pointData.nextDate=date),lastDate=date}return!that.dateIsFuture(date)}),milestoneDates},getMilestoneItems:function(seriesData){var items=[],that=this,milestoneDates=this.populateMilestoneSegmentDates(seriesData);return _.each(seriesData,function(pointData){var date=pointData.label,dateEntry=milestoneDates[date];dateEntry&&(dateEntry.pointData=_.extend(dateEntry.pointData,pointData))}),_.each(milestoneDates,function(data,date){var pointData=data.pointData,nextDate=pointData.nextDate;if(that.dateIsFuture(date));else if(nextDate){var nextName=milestoneDates[nextDate].milestoneList[0].Name;_.each(data.milestoneList,function(milestone){var name=milestone.Name;that.addVelocitySegmentEntry(items,name,nextName,date,nextDate)})}}),items},dateIsFuture:function(dateStr){var date=Ext.Date.parse(dateStr,"Y-m-d"),today=new Date;return date>today},velocityStr:function(pointDelta,months){var velocity=Math.round(100*(pointDelta/months))/100;return pointDelta+" ("+velocity+"/mo)"},subtractDates:function(d1,d2){var date1=new Date(d1),date2=new Date(d2),diff=date1.getTime()-date2.getTime();return diff/864e5}});

            Rally.launchApp('CustomApp', {
                name:"psi-feature-burnup",
	            parentRepos:""
            });

        });
    </script>


    <style type="text/css">
        .x-combo-checker{background-position:50% -2px;margin-left:1px;background-color:transparent;background-image:url("https://rally1.rallydev.com/apps/2.0/rui/resources/themes/images/default/checkbox/checkbox_unselected.png");background-position:-1px -1px;background-repeat:no-repeat;height:15px;width:15px;display:inline-block}.x-boundlist-selected .x-combo-checker{background-image:url("https://rally1.rallydev.com/apps/2.0/rui/resources/themes/images/default/checkbox/checkbox_selected.png")}
    </style>
    <style type="text/css">
        .x-combo-checker{background-position:50% -2px;margin-left:1px;background-color:transparent;background-image:url("https://rally1.rallydev.com/apps/2.0rc1/lib/ext/4.1.1a/resources/themes/images/default/grid/unchecked.gif");background-position:-1px -1px;background-repeat:no-repeat;height:14px;width:14px;display:inline-block}.x-boundlist-selected .x-combo-checker{background-image:url("https://rally1.rallydev.com/apps/2.0rc1/lib/ext/4.1.1a/resources/themes/images/default/grid/checked.gif")}
    </style>
</head>
<body>
</body>
</html>
